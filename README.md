# Внимание! 
Данный проект ещё не окончен. Находится на стадии Beta-тестирования. В процессе использования возможны критические ошибки, которые в дальнейшем будут исправляться.


# SynologySStoTelegram
Отправка видео по детектору движения Synology Surveillance Station в Telegram используя Webhook

[![Donate](https://img.shields.io/badge/donate-Tinkoff-yellow.svg)](https://www.tinkoff.ru/rm/dontsov.sergey22/KEZ6r54259)
![](https://img.shields.io/github/watchers/Striker72rus/SynologySStoTelegram.svg)
![](https://img.shields.io/github/stars/Striker72rus/SynologySStoTelegram.svg)

![](https://badgen.net/static/API/Telegram)
![](https://badgen.net/static/API/Synology%20Surveillance%20Station)
![](https://badgen.net/static/Made%20with/PHP)

## Содержание
- [Внимание!](#внимание)
- [SynologySStoTelegram](#synologysstotelegram)
  - [Содержание](#содержание)
  - [Подготовка](#подготовка)
  - [Установка через docker-compose](#установка-через-docker-compose)
  - [Установка через Container Manager](#установка-через-container-manager)
  - [Настройка проекта](#настройка-проекта)
  - [Настройка камер](#настройка-камер)
  - [Благодарность](#благодарность)
  - [TODO](#todo)
## Подготовка
1) Создаём папку через File Station в любом удобном месте.
2) Нажимаем правой кнопкой мыши по ней, выбираем свойства.
3) Нас интересует "Местоположение", его необходимо запомнить или записать, оно нам дальше пригодится.

![](/images/9.png)

Для удобства можно создать отдельного пользователя, с правами как на скриншоте:

![](/images/10.png)

<a id="A2"></a>
## Установка через docker-compose
Конфиг:
```yml
version: '3.8'
services:
    php:
        image: striker72rus/video-ss-to-tg-php:test
        hostname: php
        restart: on-failure
        volumes:
            - '/PATH_TO_DATA:/usr/src/app/data'
        ports:
            - '8888:80'
```

<a id="A3"></a>
## Установка через Container Manager

Первым делом заходим в проект и нажимаем кнопку "создать"

![](/images/1.png)
1) Вводим название проекта.
2) Выбираем путь где будет храниться compose.yaml (можно использовать путь созданный выше для данных)
3) Источник - создать docker-compose.yml
4) В поле ввода вводим данные [отсюда](#установка-через-docker-compose). Не забываем заменить путь на свой.
5) Если всё ввели и уверены в этом, смело нажимаем далее.
   
![](/images/2.png)

Нажимаем далее.

![](/images/3.png)

Проверяем данные и нажимаем "выполнено". Оставляем галочку "Запустить проект после его создания".

![](/images/4.png)

Ожидаем пока менеджер всё скачает и установит.

![](/images/5.png)

Когда увидели данную надпись, значит проект успешно установился. Можно перейти к его [настройке](#настройка-проекта).

<a id="A4"></a>
## Настройка проекта

Открываем браузер http://ip-адрес synology:порт указанный выше (по умолчанию 8888)
Пример:
```
http://192.168.1.2:8888
```
Откроется страница, нажимаем на "Настройки приложения"

![](/images/6.png)

- Project settings - доступно только одна настройка, это отправка анонимной статистики.<br>
  Если включено, проект будет отправлять мне раз в день лог приложения для его дальнейшего анализа. Так же при критической ошибке лог будет отправлен сразу же.<br>
  Можно так же вручную отправить мне статистику нажав кнопку "Отправить статистику сейчас"

- Telegram settings
  1) Вводим токен полученный от BotFather.
  2) Вводим id чата, куда присылать уведомления.
  3) Нажимаем сохранить.
  4) Нажимаем тест, в чат придёт тестовое сообщение, если его получили - значит телеграм настроен верно.
   
- Synology settings<br>
  Необходимо ввести:
  1) Ip адрес synology
  2) Порт веб интерфейса
  3) Логин
  4) Пароль
  5) OTP, если он есть. Но лучше использовать отдельного пользователя, как указано в разделе <a id="A1">подготовка</a>

Если все настройки успешны, то раздел будет выглядеть примерно так:

![](/images/6.1.png)


<a id="A5"></a>
## Настройка камер
При первом запуске будет запрос на добавление камер:

![](/images/11.png)

После обновления они появятся в интерфейсе.<br>
Поддерживаются только камеры, которые записывают 24/7 или запись по событию. **Гибридная система не поддерживается.**

![](/images/7.png)

 Отсюда можно создать правило перехвата событий кнопкой "Создать правило"<br>
 После нажатия появится окно с настройкой, его можно будет вызвать и позже по кнопке "Настроить":

![](/images/8.png)

Здесь можно настроить как будут приходить оповещения:
- **Отправка изображения при движении** - как только прилетает хук, система делает снимок с камеры и присылает его.
- **Отправка полного видео движения** - система ждёт когда закончится движение и отправит полное видео.
- **Отправка кусками** - Система будет отсылать видеофрагмент 15-секундными интервалами, до тех пор, пока движение есть.

Их можно комбинировать.

<a id="B6"></a>
## Благодарность
Спасибо за идею [samoswall](https://github.com/samoswall)

<a id="B7"></a>
## TODO
- [ ] Сделать длительность видеофрагментов настраиваемыми.
